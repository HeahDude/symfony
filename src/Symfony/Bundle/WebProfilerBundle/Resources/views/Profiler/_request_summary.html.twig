{% set status_code = request_collector ? request_collector.statuscode|default(0) : 0 %}
{% set css_class = status_code > 399 ? 'status-error' : status_code > 299 ? 'status-warning' : 'status-success' %}

<div class="status {{ css_class }}">
    <div class="container">
        <h2 class="break-long-words">
            {% if profile.method|upper in ['GET', 'HEAD'] %}
                <a href="{{ profile.url }}">{{ profile.url }}</a>
            {% else %}
                {{ profile.url }}
                {% set referer = request_collector ? request_collector.requestheaders.get('referer') : null %}
                {% if referer %}
                    <a href="{{ referer }}" class="referer">Return to referer URL</a>
                {% endif %}
            {% endif %}
        </h2>

        {% if request_collector and request_collector.redirect -%}
            {%- set redirect = request_collector.redirect -%}
            {%- set controller = redirect.controller -%}
            {%- set redirect_route = '@' ~ redirect.route %}
            <dl class="metadata">
                <dt>
                    <span class="label">{{ redirect.status_code }}</span>
                    Redirect from
                </dt>
                <dd>
                    {{ 'GET' != redirect.method ? redirect.method }}
                    {% if redirect.controller.class is defined -%}
                        {%- set link = controller.file|file_link(controller.line) -%}
                        {% if link %}<a href="{{ link }}" title="{{ controller.file }}">{% endif -%}
                        {{ redirect_route }}
                        {%- if link %}</a>{% endif -%}
                    {%- else -%}
                        {{ redirect_route }}
                    {%- endif %}
                    (<a href="{{ path('_profiler', { token: redirect.token, panel: request.query.get('panel', 'request') }) }}">{{ redirect.token }}</a>)
                </dd>
            </dl>
        {%- endif %}

        {% if request_collector and request_collector.forwardtoken -%}
            {% set forward_profile = profile.childByToken(request_collector.forwardtoken) %}
            {% set controller = forward_profile ? forward_profile.collector('request').controller : 'n/a' %}
            <dl class="metadata">
                <dt>Forwarded to</dt>
                <dd>
                    {% set link = controller.file is defined ? controller.file|file_link(controller.line) : null -%}
                    {%- if link %}<a href="{{ link }}" title="{{ controller.file }}">{% endif -%}
                        {% if controller.class is defined %}
                            {{- controller.class|abbr_class|striptags -}}
                            {{- controller.method ? ' :: ' ~ controller.method -}}
                        {% else %}
                            {{- controller -}}
                        {% endif %}
                        {%- if link %}</a>{% endif %}
                    (<a href="{{ path('_profiler', { token: request_collector.forwardtoken }) }}">{{ request_collector.forwardtoken }}</a>)
                </dd>
            </dl>
        {%- endif %}

        <dl class="metadata">
            <dt>Method</dt>
            <dd>{{ profile.method|upper }}</dd>

            <dt>HTTP Status</dt>
            <dd>{{ status_code }}</dd>

            <dt>IP</dt>
            <dd>
                <a href="{{ path('_profiler_search_results', { token: token, limit: 10, ip: profile.ip }) }}">{{ profile.ip }}</a>
            </dd>

            <dt>Profiled on</dt>
            <dd><time datetime="{{ profile.time|date('c') }}">{{ profile.time|date('r') }}</time></dd>

            <dt>Token</dt>
            <dd>{{ profile.token }}</dd>
        </dl>
    </div>
</div>
